<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- O seu CSS original será usado aqui -->
  <link rel="stylesheet" href="../css/carrinho.css"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Lilita+One&display=swap" rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Lilita+One&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Anton&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Montserrat:ital,wght@0,900;1,900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Big+Shoulders+Inline:opsz,wght@10..72,100..900&family=Emblema+One&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Big+Shoulders+Inline:opsz,wght@10..72,100..900&family=Emblema+One&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Big+Shoulders+Inline:opsz,wght@10..72,100..900&family=Emblema+One&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Mulish:ital,wght@0,200..1000;1,200..1000&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Anton&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Montserrat:ital,wght=1,900&family=Playpen+Sans:wght@100..800&display=swap"
    rel="stylesheet">
  <title>Carrinho de Compras</title>
</head>

<body>
  <div class="navbar">
    <div class="header-inner-content">

      <!-- Ícone do menu hambúrguer (aparece só no mobile ) -->
      <div class="hamburger" id="hamburger">
        ☰
      </div>

      <h1 class="logo">
        <a href="index">
          <img class="logo2" src="../img/Design sem nome (3)-Photoroom.png" alt="Logo da Shefit" />
        </a>
      </h1>
      <nav class="main-nav">
        <ul>
          <li data-content="produtos">Produtos</li>
          <li data-content="contato">Contato</li>
          <li data-content="sobre">Sobre</li>
        </ul>
      </nav>

      <div class="nav-icon-container">
        <a href="carrinho"><img src="../img/cartt.png" alt="Carrinho" /></a>
        <a href="#" onclick="document.getElementById('login-modal1').style.display='block'" class="login-button" id="login-btn-link">Login</a>

        <span class="user-name" id="user-name"></span>

        <button onclick="logout()" id="logout-btn"
          style="color: rgb(255, 255, 255); border: none;background-color: black; padding: 5px 10px; border-radius: 50rem;">Sair</button>
      </div>

    </div>
  </div>
  <!-- MODAL -->
  <div id="meuModal" class="modal">
    <div class="modal-conteudo">
      <span class="fechar">&times;</span>
      <p id="mensagemModal"></p>
    </div>
  </div>

  <!-- Modal de Login/Cadastro (Copiado do index.html) -->
  <div id="login-modal1" class="modal1">
    <div class="modal1-content">
      <span class="close-btn1" onclick="closeModal1()">&times;</span>

      <!-- Formulário de Login -->
      <div id="login-form1">
        <h2>Login</h2>
        <!-- Elemento para mensagens de login -->
        <div id="login-modal1-message" class="alert alert-error" style="display: none;"></div>
        <input type="text" id="login-username" placeholder="E-mail" />
        <input type="password" id="login-password" placeholder="Senha" />
        <button onclick="login1()">Entrar</button>
        <p>Ainda não tem conta? <a href="#" onclick="toggleForm1()">Cadastre-se</a></p>
      </div>

      <!-- Formulário de Cadastro -->
      <div id="register-form1" style="display: none;">
        <h2>Cadastro</h2>
        <!-- Elemento para mensagens de cadastro -->
        <div id="register-form1-message" class="alert alert-error" style="display: none;"></div>

        <input type="text" id="register-cpf" placeholder="CPF" maxlength="14" onblur="checkCPF()">
        <input type="text" id="register-name" placeholder="Nome completo" required>
        <input type="text" id="register-phone" placeholder="Telefone" maxlength="15" required>
        <input type="text" id="register-username" placeholder="E-mail" required>
        <input type="password" id="register-password" placeholder="Senha" required>
        <!-- Campo CEP -->
        <input type="text" id="register-cep" placeholder="CEP" maxlength="8">

        <!-- Campos que vão receber os dados -->
        <input type="text" id="register-street" placeholder="Rua">
        <input type="text" id="register-neighborhood" placeholder="Bairro">
        <input type="text" id="register-city" placeholder="Cidade">
        <input type="text" id="register-state" placeholder="Estado">
        <div id="cep-error" style="color:red; margin-top:5px; display:none;">CEP inválido</div>
        <!-- Loader -->
        <div id="cep-loader" style="display:none; text-align:center; margin-top:5px;">
          <img src="../img/loading.gif" alt="Carregando..." width="30">
        </div>

        <button onclick="register1()">Cadastrar</button>
        <p>Já tem conta? <a href="#" onclick="toggleForm1()">Fazer login</a></p>

        <!-- Mensagem que aparece para sucesso ou erro -->
        <div id="register-message" style="display:none; margin-top:10px; color: green; font-weight: bold;"></div>
      </div>
      <!-- Mensagem que aparece para sucesso ou erro -->
      <div id="register-message" style="display:none; margin-top:10px; color: green; font-weight: bold;"></div>

      <div id="register-loader" style="display:none; margin-top:10px; text-align:center;">
        <div class="loader"></div>
      </div>
    </div>
  </div>
  <section id="carrinho">
    <h2>Seu Carrinho de Compras</h2>
    <div class="cart-items" id="cart-items">
      <!-- Itens do carrinho serão adicionados aqui dinamicamente -->
    </div>
    <div class="cart-total">
      Total: <span id="cart-total">0,00 R$</span>
      <button id="checkout-button">Finalizar Compra</button>
    </div>
  </section>

  <footer>
    <div class="footer-container">
      <div class="footer-section about">
        <h2>Sobre a SheFit</h2>
        <p>Na SheFit, oferecemos roupas fitness de alta qualidade para que você se sinta confortável e confiante
          durante seus treinos.</p>
      </div>
      <div class="footer-section links">
        <h2>Links Rápidos</h2>
        <ul>
          <li><a href="index#top">Voltar</a></li>
        </ul>
      </div>
      <div class="footer-section contato">
        <h2>Contato</h2>
        <p><strong>Email:</strong> contato@shefit.com</p>
        <p><strong>Telefone:</strong> +55 11 99999-9999</p>
        <a href="https://wa.me/5511999999999" target="_blank">
          <img src="../img/10000484_processed.jpg" alt="WhatsApp da SheFit" style="width: 40px; height: auto;">
        </a>
        <a href="https://instagram.com/use.shefit/" target="_blank">
          <img src="../img/logotipo-da-aplicacao-instagram-em-fundo-branco_1301901-2125_processed.png"
            alt="WhatsApp da SheFit" style="width: 40px; height: auto;">
        </a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 SheFit. Todos os direitos reservados.</p>
    </div>
  </footer>

  <!-- Incluindo o carrinho.js que contém as funções de gerenciamento -->
  <script src="../js/carrinho.js"></script> 
  <script src="../js/auth-completo.js"></script> <!-- NOVO: Para login/cadastro -->

  <script>
    // Funções de controle do modal (toggleForm1, closeModal1, etc. )
    // Estas funções precisam estar aqui para que o HTML as encontre, mesmo que a lógica principal esteja no auth-completo.js
    function toggleForm1() {
        const loginForm = document.getElementById('login-form1');
        const registerForm = document.getElementById('register-form1');

        if (loginForm.style.display !== 'none') {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        } else {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        }
    }

    function closeModal1() {
        document.getElementById('login-modal1').style.display = 'none';
    }

    // ========================================
    // LÓGICA DO CARRINHO ATUALIZADA
    // ========================================

    // Função auxiliar para formatar o preço
    function formatarPreco(valor) {
      return valor.toFixed(2).replace('.', ',');
    }

    /**
     * Renderiza os itens do carrinho
     */
    function renderizarCarrinho() {
      // Usa a função obterCarrinho do carrinho.js
      const carrinho = obterCarrinho(); 
      const cartItemsContainer = document.getElementById("cart-items");
      
      if (carrinho.length === 0) {
        cartItemsContainer.innerHTML = "<p>Seu carrinho está vazio.</p>";
        document.getElementById("cart-total").textContent = `0,00 R$`;
        return;
      }

      cartItemsContainer.innerHTML = ''; // Limpa o container antes de renderizar

      carrinho.forEach(item => {
        const itemElement = document.createElement("div");
        itemElement.classList.add("cart-item");
        
        // Calcula o subtotal do item
        const subtotalItem = (parseFloat(item.preco) || 0) * (item.quantidade || 1);

        itemElement.innerHTML = `
          <div class="cart-item-details">
              <img src="${item.imagem}" alt="${item.nome}" style="width: 100px; height: 100px; object-fit: cover; margin-right: 10px;">
              
              <div class="item-info">
                <h3>${item.nome}</h3>
                <p>Preço Unitário: R$ ${formatarPreco(parseFloat(item.preco) || 0)}</p>
                <p>Subtotal: R$ <span id="subtotal-${item.id}">${formatarPreco(subtotalItem)}</span></p>
              </div>

              <div class="item-quantidade">
                <button onclick="alterarQuantidade(${item.id}, -1)">-</button>
                <span id="quantidade-${item.id}">${item.quantidade}</span>
                <button onclick="alterarQuantidade(${item.id}, 1)">+</button>
              </div>

              <button onclick="removerItem(${item.id})">Remover</button>
          </div>
        `;

        cartItemsContainer.appendChild(itemElement);
      });

      // Atualiza o total do carrinho
      document.getElementById("cart-total").textContent = `${formatarPreco(calcularTotal())} R$`;
    }

    /**
     * Altera a quantidade de um produto e atualiza a exibição
     * @param {number} produtoId - ID do produto
     * @param {number} incremento - 1 para aumentar, -1 para diminuir
     */
    function alterarQuantidade(produtoId, incremento) {
      const carrinho = obterCarrinho();
      const produto = carrinho.find(item => item.id === produtoId);
      
      if (produto) {
        const novaQuantidade = produto.quantidade + incremento;
        
        // Usa a função atualizarQuantidade do carrinho.js
        atualizarQuantidade(produtoId, novaQuantidade); 
        
        // Re-renderiza o carrinho para atualizar a interface
        renderizarCarrinho(); 
      }
    }

    /**
     * Remove um item do carrinho e atualiza a exibição
     * @param {number} produtoId - ID do produto
     */
    function removerItem(produtoId) {
      if (confirm('Deseja realmente remover este produto do carrinho?')) {
        // Usa a função removerDoCarrinho do carrinho.js
        removerDoCarrinho(produtoId); 
        
        // Re-renderiza o carrinho para atualizar a interface
        renderizarCarrinho(); 
      }
    }

    // Inicializa a renderização do carrinho ao carregar a página
    document.addEventListener('DOMContentLoaded', renderizarCarrinho);
    
  </script>
</body>

</html>
